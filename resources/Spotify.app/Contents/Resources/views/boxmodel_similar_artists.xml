<?

if next(data) == nil then
data = {
  artist = {
    link = "spotify:search:apa",
    image = "http://martinaengwall.webblogg.se/images/2008/pgm9fisk_11098470.jpg",
    name = "Singing the blues",
  },
  artists = {
    {
	  link = "spotify:search:apa",
      image = "http://martinaengwall.webblogg.se/images/2008/pgm9fisk_11098470.jpg",
      name = "Singing the blues",
	  year = 2004,
	},
	{
	  link = "spotify:search:apa",
      image = "http://martinaengwall.webblogg.se/images/2008/pgm9fisk_11098470.jpg",
      name = "Singing the blues",
	  year = 2004,
	},
    {
	  link = "spotify:search:apa",
      image = "http://martinaengwall.webblogg.se/images/2008/pgm9fisk_11098470.jpg",
      name = "Singing the blues",
	  year = 2004,
	},
	{
	  link = "spotify:search:apa",
      image = "http://martinaengwall.webblogg.se/images/2008/pgm9fisk_11098470.jpg",
      name = "Singing the blues",
	  year = 2004,
	},
    {
	  link = "spotify:search:apa",
      image = "http://martinaengwall.webblogg.se/images/2008/pgm9fisk_11098470.jpg",
      name = "Singing the blues",
	  year = 2004,
	},
	{
	  link = "spotify:search:apa",
      image = "http://martinaengwall.webblogg.se/images/2008/pgm9fisk_11098470.jpg",
      name = "Singing the blues",
	  year = 2004,
	},
    {
	  link = "spotify:search:apa",
      image = "http://martinaengwall.webblogg.se/images/2008/pgm9fisk_11098470.jpg",
      name = "Singing the blues",
	  year = 2004,
	},
	{
	  link = "spotify:search:apa",
      image = "http://martinaengwall.webblogg.se/images/2008/pgm9fisk_11098470.jpg",
      name = "Singing the blues",
	  year = 2004,
	}
  }
}
end

function printyears(years)
  i = 0
	for word in string.gmatch(years, "%S+") do
    if i ~= 0 then print ", " end
    i = i + 1
		if word:sub(-1) == ',' then word = word:sub(1, -2) end
  	w = word
		if w:sub(-1) == 's' then
			v = tonumber(w:sub(1,2)) + 1900
			if v == 1900 then v = v + 100 end
			w = string.format("%d-%d", v, v+9)
		else
			if w:sub(1,1) == '-' then w = "1900" .. w end
			if w:sub(-1) == '-' then w = w .. "2099" end
		end
		?><link url="${searchuri(w,"year")}">${word}</link><?
	end
end
?>

<document>
  <style>
    smallImage { width: 64; height: 64; shadow: 1; margin: 0,0,15,1; image-mode: cutout; }
    entryImage { width: 128; height: 128; shadow: 1; image-mode: cutout; align:center; }

    titleText { face: arial; size:14; bold:1; textshadow: #000 0 1; color:#fff; margin: 0,0,0,5; }
    titleDesc { face: tahoma; size:13; textshadow: #262626 0 -1; max-lines:2; flex:1; color:#aaa; }

    entryLine1 { face:arial; size:13; bold:1; color: #fff; textshadow: #000 0 1; max-lines: 1; flex: 1; margin: 0,8,0,0; align: center; }
    entryLine2 { face:tahoma; size:11; color:#888; textshadow: #262626 0 -1; max-lines: 1; flex: 1; margin:0,2,0,0; align: center; }
  </style>
  <scrollview background="bg_plaid.png" backgroundRepeat="xy">
	<img src="bg_top_highlight.png" imagemode="tilex" align="top" />
    <vbox margin="0,20,0,0">
      <box>
        <autogrid colspacing="0" rowspacing="0" maxWidth="inf" margin="0,0,12,0">

          % for i,artist in ipairs(data.artists) do
          <vbox style="width: 128; height: 190; margin: 12,0,0,0" flex="1" maxwidth="inf" align="center">
            <!--
            Separators are drawn on each box in the flow, but each of them is,
            through negative margins, drawn big enough to cover the entire
            width of a reasonably wide view.
            c.f. <box style="separator" margin="0,0,0,12" />
            -->
            <link url="${artist.link}"><img src="${artist.image_id}" style="entryImage" alt="PlaceholderArtist|128" /></link>
            <text style="entryLine1"><link url="${artist.link}">${artist.name}</link></text>
            <text style="entryLine2"><? printyears(artist.year) ?></text>
          </vbox>
          % end

        </autogrid>
      </box>
    </vbox>
  </scrollview>
</document>
