<?
-- This page uses generic_header.xml.

if not data.name then
data = {
	tracks = 1,
	subscribers = {},
	time = 380,
	name = "test",
	text = "description",
	collaborative = false,
	offline_available = true,
	can_offline_sync = true,
	self = true,
--	playlist_subscribed = true,
}
end

subscribers_dropdown = function()
?>
% if #data.subscribers > 0 then
<deck margin="-6,1" onMouseDown="subscribers" mouseOffsets="2,1" align="left">

%   subscribers_button = function(sela, selb, selc)
  <box>
    <img alt="MainListDropdownBg|${sela}" margin="0,-1,0,-1" />
    <hbox margin="10,0,10,0">
      <text margin="0,0,0,0" style="skinfont: MainListDropdown|${selb}; size:15">@{Playlist stats subscribers ${data.subscriber_count}} </text>
      <img margin="0,4,0,0" imagemode="native" align="top" alt="RecessedDropdownArrow|${selc}" />
    </hbox>
  </box>
%   end
%   subscribers_button("","","")
%   subscribers_button("mousedown","","")
%   subscribers_button("down","down","down")
</deck>
% end
<?
end

subscribers = function()
?>
<style>
  imageSubscriber {
    width: 60;
    height: 60;
    image-mode: cutout;
  }
  textSubscriber {
    textDescription;
    link-color:#ccc;
    hoverlink-color:#fff;
    hoverlink-underline:1;
  }
</style>
%--<debug color="#fff"></debug>
<vbox flex="66">
  ${ insert(subscribers_dropdown) }
  <flow height="60" colspacing="0" rowspacing="0" maxlines="1" margin="0,4,0,4">
  % for i, subscriber in ipairs(data.subscribers) do
    <link url="${subscriber.link}">
      <img style="imageSubscriber" src="${subscriber.image}" alt="PlaceholderArtist|60" />
    </link>
  % end
  </flow>
  <text style="textSubscriber" maxlines="2"><?
  for i, subscriber in ipairs(data.subscribers) do
    if i ~= 1 then
      print(" â€¢ ")
    end
    ?><link url="${subscriber.link}">${subscriber.name}</link><?
  end
  ?></text>
</vbox>
<?
end

playlist_title = function()
  if data.collaborative then
?><font color="#c5ffd3">${data.name}</font><?
  else
?>${data.name}<?
  end
end

playlist_stats = function()
?>@{Playlist stats tracks ${data.tracks}}, ${ formatduration(data.time) } <?
end

print_description = function()
	print(data.spider_text)
end

playlist_icon = "SidebarRowIcon|list"
if data.collaborative then
  playlist_icon = "SidebarRowIcon|collab-list"
end

template = {
  image = data.image,
  image_alt = "PlaceholderPlaylist|128",
  icon = playlist_icon,
  stats = playlist_stats,
  title = playlist_title,
  description = print_description,
  offline_available = data.offline_available,
  purchase = {
    tracks = data.purchase_tracks,
	price = data.purchase_price,
	page = data.purchase_page,
	verb = data.purchase_verb,
  },
  title_items = {
    "standard_title",
    "filler",
    "stats"
  },
  toolbar_items = {
    "share",
  },
  right_items = {
  }
}

if data.subscriber_count ~= 0 then
  table.insert(template.right_items, subscribers)
end

if not data.self then
  template.author = data.owner
  template.author_link = data.owner_link
end

table.insert(template.toolbar_items, "filler")
table.insert(template.toolbar_items, "available_offline")

include("views/generic_header.xml")

?>

